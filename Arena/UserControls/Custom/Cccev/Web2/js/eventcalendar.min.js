var eventProfiles=[];var currentDate=new Date();$(function()
{$("#event-calendar").fadeIn("fast");calendarParams.campus=getCampusForCalendar();calendarParams.topicIDs=$("#ihTopicAreas").val().trim()!=''?$("#ihTopicAreas").val():'';initEventCalendar(calendarParams);$(document).bind("CALENDAR_INFO_CHANGED",function(e,data)
{switch(currentView.toLowerCase().trim())
{case"cloud":updateCloudView(e,data);break;case"list":updateEventListView(e,data);break;case"calendar":default:updateCalendarView(e,data);break;}
return false;});$(document).bind("CALENDAR_VIEW_CHANGED",function()
{loadView();return false;});});function loadView()
{clearViews();switch(currentView.toLowerCase().trim())
{case"calendar":$("#event-calendar").fullCalendar("destroy");$("#event-calendar").fadeIn("fast");initEventCalendar(calendarParams);break;case"cloud":initEventCloud(calendarParams);$("#event-cloud").fadeIn("fast");break;case"list":initEventList(calendarParams);$("#event-list-wrapper").fadeIn("fast");break;}}
function clearViews()
{$("html, body").animate({scrollTop:0},1000,"easeOutCubic");getOverlay(currentView).css({height:$(".event-view:visible").outerHeight()+30+"px"}).fadeIn("fast");$(".event-view").fadeOut("fast");}
function getOverlay(view)
{switch(view.trim())
{case"cloud":return $("#cloud-overlay");case"list":return $("#event-list-overlay");case"calendar":default:return $("#calendar-overlay");}}
function toolTipOver(element,event,className)
{var div=element.children(className);if(div.is(":hidden"))
{var offset=element.offset();div.css({left:event.pageX-offset.left+20+"px",top:event.pageY-offset.top+"px"}).fadeIn("fast");}}
function toolTipOut(element,className)
{var div=element.children(className);if(div.is(":visible"))
{element.children(className).fadeOut("fast");}}
function toolTipMove(element,event,className)
{var div=element.children(className);if(div.is(":visible"))
{var offset=element.offset();div.css({left:event.pageX-offset.left+20+"px",top:event.pageY-offset.top+"px"})}}
function getEventTimeString(time)
{var timeString=time.toTimeString();var timeParts=timeString.split(':');var hours=timeParts[0];var minutes=timeParts[1];var isAM=true;if(parseInt(hours)>12)
{isAM=false;hours=hours-12;}
if(hours.length>1&&hours[0]==0)
{hours=hours[1];}
var theTime=hours+":"+minutes;theTime+=isAM?" AM":" PM";return theTime;}
function initEventCalendar(params)
{$("#event-calendar").fullCalendar({viewDisplay:bindCalendarViewEvents,events:function(start,end,callback)
{var pageID=$("#ihCalendarEventDetails").val();postAsyncJson("webservices/custom/cccev/web2/eventsservice.asmx/GetEventList",'{ "start":"'+start.toDateString()+'", "end":"'+end.toDateString()+'", "keywords":"'+params.keywords+'", "topicIDs":"'+params.topicIDs+'", "campusID":'+params.campus.campusID+', "pageID": '+pageID+' }',function(result)
{eventProfiles=result.d;callback(eventProfiles);bindCalendarViewEvents();return false;},function(result,errorText,thrownError)
{return false;});},loading:function(isLoading,view)
{if(isLoading)
{$("#calendar-overlay").css({height:$("#event-calendar").outerHeight()+20+"px"}).fadeIn("fast");}
else
{$("#calendar-overlay").fadeOut("fast");}
return false;}});if(currentDate.getMonth()!=new Date().getMonth())
{$("#event-calendar").fullCalendar('gotoDate',currentDate);}}
function updateCalendarView(e,data)
{var view=$("#event-calendar").fullCalendar("getView");var sDate=view.start;if(sDate.getFullYear<1900)
{sDate=new Date(sDate.getFullYear()+1900,sDate.getMonth(),sDate.getDate());}
currentDate=sDate;$("#event-calendar").fullCalendar("destroy");initEventCalendar(data);return false;}
function bindCalendarViewEvents(view)
{$(document).trigger("CONTENT_RENDERED");$(".fc-event").hoverIntent(function(event)
{toolTipOver($(this),event,".fc-event-description");return false;},function()
{toolTipOut($(this),".fc-event-description");return false;}).mousemove(function(event)
{toolTipMove($(this),event,".fc-event-description");return false;});}
function getCondensedEvents(profiles)
{var condensedEvents=[];for(var i=0;i<profiles.length;i++)
{var hasMatch=false;var event=profiles[i];for(var j=0;j<condensedEvents.length;j++)
{if(event.id==condensedEvents[j].id)
{hasMatch=true;break;}}
if(!hasMatch)
{var date=new Date(event.start);event.time=getMonth(date)+" "+getDayOfMonth(date)+", "+getEventTimeString(date);condensedEvents.push(event);}}
return condensedEvents;}
function initEventCloud(params)
{var pageID=$("#ihCloudEventDetails").val();postAsyncJson("webservices/custom/cccev/web2/eventsservice.asmx/GetAlphabeticalEventList",'{ "start":"'+params.start.toDateString()+'", "end":"'+params.end.toDateString()+'", "keywords":"'+params.keywords+'", "topicIDs":"'+params.topicIDs+'", "campusID":'+params.campus.campusID+', "pageID": '+pageID+' }',function(result)
{eventProfiles=result.d;var condensed=getCondensedEvents(eventProfiles);$("#event-cloud ul").children().remove();$("#cloud-item").render(condensed).appendTo("#event-cloud ul");$("#event-cloud .campus").html(calendarParams.campus.name);bindCloudEvents();$("#cloud-overlay").fadeOut("fast");return false;},function(result,errorText,thrownError)
{alert(result.responseText);return false;});}
function updateCloudView(e,data)
{$("#cloud-overlay").fadeIn("fast");initEventCloud(data);return false;}
function bindCloudEvents()
{$(".tag").hoverIntent(function(event)
{toolTipOver($(this),event,".tag-description");return false;},function()
{toolTipOut($(this),".tag-description");return false;}).mousemove(function(event)
{toolTipMove($(this),event,".tag-description");return false;});}
var MONTHS=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");function initEventList(params)
{$("#event-list-overlay").height($("#event-list-overlay").parent().height()+200);$("#event-list-overlay").fadeIn("fast");var pageID=$("#ihListEventDetails").val();postAsyncJson("webservices/custom/cccev/web2/eventsservice.asmx/GetEventList",'{ "start":"'+params.start.toDateString()+'", "end":"'+params.end.toDateString()+'", "keywords":"'+params.keywords+'", "topicIDs":"'+params.topicIDs+'", "campusID":'+params.campus.campusID+', "pageID": '+pageID+' }',function(result)
{eventProfiles=result.d;renderEventList(eventProfiles);$("#event-list-overlay").fadeOut("fast");return false;},function(result,errorText,thrownError)
{alert(result.responseText);return false;});}
function updateEventListView(e,data)
{initEventList(data);return false;}
function renderEventList(eventProfiles)
{$("#event-featured-list").children().remove();$("#event-list").children().remove();if(eventProfiles===undefined||eventProfiles.length==0)
{return false;}
for(var i=0;i<eventProfiles.length;i++)
{eventProfiles[i].date=getDayOfMonth(new Date(eventProfiles[i].start));eventProfiles[i].month=getMonth(new Date(eventProfiles[i].start));}
var featuredEvents=getCondensedEvents(eventProfiles);var maxItems=4;if(featuredEvents.length<maxItems)
{maxItems=featuredEvents.length;}
maxItems=(maxItems==3)?2:maxItems;featuredEvents=featuredEvents.slice(0,maxItems);$("#event-featured-list-template").render(featuredEvents).appendTo("#event-featured-list");$("#event-list-template").render(eventProfiles).appendTo("#event-list");return false;}
function getDayOfMonth(aDate)
{var day=aDate.getDate();if(day<10)
{day="0"+day;}
return day;}
function getMonth(aDate)
{return MONTHS[aDate.getMonth()];}